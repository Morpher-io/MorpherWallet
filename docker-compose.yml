# Use root/example as user/password credentials
version: '3.1'

services:
    db:
        image: postgres
        restart: always
        environment:
            POSTGRES_PASSWORD: example
            POSTGRES_DB: zerowallet
        volumes:
            - ./initdb.sql:/docker-entrypoint-initdb.d/initdb.sql
            - postgres_data:/var/lib/mysql
        ports:
            - "5432:5432"
    backend:
        build:
            context: ./backend-node
            dockerfile: Dockerfile
        image: morpher/backend-node
        restart: always
        volumes:
            - ./backend-node:/usr/src/app
            - /usr/src/app/node_modules
        ports:
            - "8080:80"
        command: "npm run start:watch"
        environment: 
            PORT: 80
            ENVIRONMENT: 'development'
            DB_HOST: 'db'
            DB_USER: 'postgres'
            DB_PASSWORD: 'example'
            DB_NAME: 'zerowallet'
            DB_DIALECT: 'postgres'
            FACEBOOK_APP_ID: '299132904630133'
            FACEBOOK_APP_SECRET: 'db3693734c6dd7c5581d5e1f012e3e84'
            GOOGLE_APP_ID: '376509986959-k6tstmq30f4spbp9vd1u94tvt8dg714b.apps.googleusercontent.com'
            GOOGLE_APP_SECRET: 'Lf03bMX-jV5uP-USJ-J5QFkQ'
            TWITTER_APP_ID: 'hCiGjX80GPANJIKKeE4cCSsyU'
            TWITTER_APP_SECRET: 'neGkY4nvHhzw8QBNXYQzB0zwXte6WNSzNMf1C6evSjuDXdYF6U'
            VK_APP_ID: '7548057'
            DB_BACKEND_SALT: 'kjdfkjdfkjdfkjdfkjdfkjdfkjdkfjdkkjdfkjdfkjdfkjdfkjdfkjdfkjdkfjdk'
    vue:
        build:
            context: ./vue
            dockerfile: Dockerfile
        image: morpher/zerowallet-frontend-vue
        restart: always
        volumes:
            - ./vue:/usr/src/app
            - /usr/src/app/node_modules
        ports:
            - "3001:3001"
        environment: 
            CHOKIDAR_USEPOLLING: 1

volumes:
    postgres_data:
        driver: local